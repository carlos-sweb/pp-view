<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="master.css">
</head>
<body>
<div pp-view="main" id="content" >
	<h1 class="title" >Hello</h1>
	<h4 class="title" >Hello</h4>
</div>


<script src="https://cdn.jsdelivr.net/npm/pp-elementjson.js@1.0.3/pp-elementjson.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/pp-events@1.0.5/pp-events.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/pp-model.js@1.0.7/pp-model.min.js" ></script>

<script type="text/javascript" >
"use strict";
(function(global , factory ){

  	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :

  	typeof define === 'function' && define.amd ? define('ppView', factory) :

	(global = global || self, (function () {

		var exports = global.ppView = factory( global.ppModel  ,global. ppElementjson , global.ppEvents );

	}()

));

})( this,(function( _model , _elementjson , _events ) {
	// ===========================================================================
	function isObject(value) {
		return value && {}.toString.call(value) === '[object Object]';
	}
	// ===========================================================================
	function isString(value) {
		return value && {}.toString.call(value) === '[object String]';
	}
	// ===========================================================================
	var isUndefined = function( value ){
		return value && {}.toString.call(value) === '[object Undefined]';
	}
	// ===========================================================================
	var isNull = function( value ){
		return value === null;
	}
	// ===========================================================================
	var has = function( value , property){
		return value.hasOwnProperty( property );
	}
	// ===========================================================================
	var getKeys = function( value ){
		return Object.keys( value );
	}
	// ===========================================================================
	var isElement = function( value ){
		return !!( value && value.nodeType === 1 );
	}
	// ===========================================================================
	/*
	*@name isFunction
	*@type Function
	*@description es una funcion que verifica is el parametro
	*entregado es una funcion
	*/
	function isFunction(func) {
		return func && {}.toString.call(func) === '[object Function]';
	}
	// ===========================================================================
	/*
	*@name render
	*@type render
	*@params
	*	@element = element html
	*   @html = html code
	*@description: renderizamos el html en el elemento
	*/
	function render( element , html ){
		if( typeof html === 'string' ){
			if( isElement( element ) ){
				element.innerHTML = html;
			}
		}
	}


	// ===========================================================================
	/*
	*@name ErrorThrow
	*@type Function
	*@params
	*	@msg {String}= Mensaje
	*@description: Lanzamos un error
	*/
	function ErrorThrow( msg ){
		throw msg;
	}

	function isUrlHttp( url ){
		return isString( url );
	}

	// ===========================================================================
	/*
	*@name getView
	*@type Function
	*@params
	*	@options {Object}= La configuración principal
	*@description: capturamos el elemento html para el prcedimeinto de la clase
	*/
	function getView( options ){
		if(!isObject(options)){ ErrorThrow('options dont defined')};
		// El Mensaje de error  a analizar
		var msgError = 'View dont defined';
		// Defininedo la view
		var view = has( options , 'view' ) ? (
			isString( options.view ) ? (
					/* Es una cadena verificamos que no este vacia*/
				 options.view !== '' ? (
					// En este punto es una cadena y no esta vacia
					!isNull( document.querySelector('[pp-view='+options.view+']') ) ?
					document.querySelector('[pp-view='+options.view+']') : ErrorThrow(msgError)
				) : ErrorThrow(msgError)
			 ):
			/* lo que recivimos no es un string*/
			(
				isElement( options.view ) ? options.view :
				/* en este punto existe la clave pero no es un string ni element html*/
				ErrorThrow(msgError)
			)
		):/* No existe la llave view - un problema*/  ErrorThrow(msgError);
		return view;
	}

	// ===========================================================================
	/*
	*@name getView
	*@type Function
	*@params
	*	@options {Object}= La configuración principal
	*@description: capturamos el elemento html para el prcedimeinto de la clase
	*/
	function getTemplate(options){

			if(!isObject(options)){ return "";}

			return has( options ,  'template' ) ? (
				//Verificamos que sea una String
				isString( options.template ) ? options.template : ErrorThrow('Must template option will be string')
			) : has( options , 'templateJson'  ) ? (
				//Verificamos que sea un object
				isObject( options.templateJson ) ? options.templateJson : ErrorThrow('Must templateJson option will be object')
			) : has( options , 'templateUrl' ) ? (
				//Verificamos que sea Url
				isUrlHttp( options.templateUrl ) ? options.templateUrl : ErrorThrow('Must templateUrl option will be string url')
			) : undefined;

	}
	// ===========================================================================
	/*
	*@name getEvents
	*@type Function
	*@params
	*	@options {Object}= La configuración principal
	*@description: capturamos los events para ser procesados
	*/
	function getEvents( options ){
		var events = [];
		if( has( options , 'events' ) ){
			var events = options.events;
			if( isObject( events ) ){
				var eventsKey = getKeys( events );
				for( var i = 0; i < eventsKey.length ; i++ ){
					var tagEvent = eventsKey[i].split("|");
					var method = events[ eventsKey[i] ];
					if( tagEvent.length === 2 ){
						var _Tag = tagEvent[0];
						var _Event = tagEvent[1];
							//var elementLisen = this.view.querySelectorAll(_Tag);
							//for( var a = 0; a < elementLisen.length ; a++ ){
										/*
										elementLisen[a].addEventListener(_Event,function(e){
												if( isFunction( options.methods[method] ) ){
														options.methods[method]( e.currentTarget , this.model , e  );
												}
										}.bind(this));
										*/

							//}
					}
				}
			}
		}

		return events;

	}

	// ===========================================================================
	/*
	*@name getModel
	*@type Function
	*@params
	*	@options {Object}= La configuración principal
	*@description: Crea revisando el ppModel
	*/
	function getModel( options ){

			if( !isObject(options) ){ return {}; };
			// Verificamos que se halla pasado un modelo
			// se se ocupa la extendio pp-model se activa
			// en caso contrato solo se crea un objeto simple
			var modelObject = has( options , 'model' )  ? (
				isObject(options.model) ? options.model : {}
			) :  {} ;

			var model =  isFunction( _model )  ?  new _model() : modelObject;

			return isFunction( model ) ? new model( modelObject ) : model;

	}
	// ===========================================================================
	return function( options ){
		//==========================================================================
		if( options === undefined ){
			console.error('Crital Error')
			console.error( 'pp-view say : Must provide object config' );
			return;
		}
		//==========================================================================
		if( !isObject( options ) ){
			console.error('Crital Error')
			console.error( 'pp-view say : Must provide object config' );
			return;
		}
		// =========================================================================
		// ===== IDENTIFICACIÓN DEL ELEMENTO A PROCESAR
		try{
				this.view = getView( options );
		}catch( viewError ){
				console.error( "Critical Error: ");
				console.error( "pp-view say : "+viewError );
				return;
		}
		// =========================================================================
		// Definimos el tipo de template que vamos a procesar
		// SI NO ESTA
		try{
			this.template = getTemplate( options );
		}catch( ErrorTemplate ){
				console.warn( ErrorTemplate );
		}
		//==========================================================================
		//===== Procesamos el modelo
		this.model = getModel( options );
		//==========================================================================
		//======= RENDERIZAMOS EL TEMPLATE SI ES DIFERENTE A UNDEFINED
	 	!isUndefined(this.template) && render( this.view , this.template );
		//======= ENLAZAMOS LOS EVENTOS CON EL RENDERIZADO si ubiese
		this.events = getEvents( options );

		console.log( this.events );


		/*
		// EVENTS
		this.events = isFunction(_events) ? new _events() : null ;
		// ELEMENTjSON
		var elemjson = isFunction(_elementjson) ?  new _elementjson() : null;
		//==========================================================================
		//====== RENDER SECTION
		if( !isNull( this.TYPE_TEMPLATE ) ){

		}
		//==========================================================================
		//====== EVENTS SECTION
		if( has( options , 'events' ) ){
				var keys = getKeys( options.events );
				for( var i = 0 ; i < keys.length ; i++ ){
							console.log( keys[i] );

				}
		}
		*/
		//==========================================================================

	}

}))


</script>
<script src="https://cdn.jsdelivr.net/npm/pp-router.js@2.1.1/pp-router.min.js" ></script>
<script type="text/javascript">


var config = {
	view: 'main',
	model:{
		title:"esto es un titulo"
	},
	events:{
		"#header1|click":"hello",
	},
	template:'<h1 id="header1" >Hello Word</h1>',
	methods:{
		hello:function( element , model , event ){
			console.log( element );
			console.log( model.get("title") );
			console.log( model.set("title","Otro titulo") );
			console.log( event );
		}
	},
	controller:function( params ){
		console.log("Estamos aplicando el controlador");
		// Initialize
		//console.log( this );
	}
}

var view = new ppView( config )

</script>
</body>
</html>
